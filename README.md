┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                    CLIENT LAYER                                      │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐             │
│  │  Mobile App  │  │   Web App    │  │ Admin Panel  │  │  Partner API │             │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘             │
└─────────┼─────────────────┼─────────────────┼─────────────────┼─────────────────────┘
          │                 │                 │                 │
          └────────────────┬┴─────────────────┴─────────────────┘
                           │ HTTPS (JWT Auth)
                           ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              API GATEWAY LAYER                                       │
│  ┌─────────────────────────────────────────────────────────────────────────────┐    │
│  │                    Spring Boot API Gateway (port: 8080)                     │    │
│  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────────────┐   │    │
│  │  │ JWT Filter  │ │ Rate Limit  │ │ Request Log │ │ Circuit Breaker     │   │    │
│  │  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────────────┘   │    │
│  └─────────────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────────────┘
                           │
          ┌────────────────┼────────────────┬────────────────┐
          │                │                │                │
          ▼                ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                           SPRING BOOT SERVICES LAYER                                 │
│                                                                                      │
│  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐                   │
│  │ Reservation Svc  │  │   Vehicle Svc    │  │   Customer Svc   │                   │
│  │  - 예약 CRUD      │  │  - 차량 관리      │  │  - 회원 관리      │                   │
│  │  - 결제 연동      │  │  - 재고 관리      │  │  - 인증/인가      │                   │
│  └────────┬─────────┘  └────────┬─────────┘  └────────┬─────────┘                   │
│           │                     │                     │                              │
│  ┌──────────────────────────────────────────────────────────────────────────────┐   │
│  │                         AI Proxy Controller                                   │   │
│  │   /api/recommendations  /api/chat  /api/pricing  /api/analytics              │   │
│  └──────────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────────┘
                           │
                           │ REST API (Internal Network)
                           │ HTTP/2 + JSON
                           ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                            PYTHON AI SERVICES LAYER                                  │
│                                                                                      │
│  ┌────────────────────────────────────────────────────────────────────────────┐     │
│  │                    FastAPI AI Gateway (port: 8000)                          │     │
│  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐           │     │
│  │  │ Health Check│ │ Model Router│ │ Feature Eng │ │ Cache Layer │           │     │
│  │  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘           │     │
│  └────────────────────────────────────────────────────────────────────────────┘     │
│           │                     │                     │                │             │
│           ▼                     ▼                     ▼                ▼             │
│  ┌──────────────┐      ┌──────────────┐      ┌──────────────┐  ┌──────────────┐     │
│  │ Recommend    │      │  Chatbot     │      │   Pricing    │  │  Analytics   │     │
│  │ Engine       │      │  Service     │      │   Predictor  │  │  Engine      │     │
│  │ (port:8001)  │      │ (port:8002)  │      │  (port:8003) │  │ (port:8004)  │     │
│  │              │      │              │      │              │  │              │     │
│  │ - CF/CBF     │      │ - RAG        │      │ - XGBoost    │  │ - Funnel     │     │
│  │ - Embedding  │      │ - LangChain  │      │ - TimeSeries │  │ - Cohort     │     │
│  │ - ALS        │      │ - Vector DB  │      │ - Prophet    │  │ - Segment    │     │
│  └──────┬───────┘      └──────┬───────┘      └──────┬───────┘  └──────┬───────┘     │
└─────────┼─────────────────────┼─────────────────────┼─────────────────┼─────────────┘
          │                     │                     │                 │
          └──────────┬──────────┴──────────┬──────────┴─────────────────┘
                     │                     │
                     ▼                     ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              DATA & STORAGE LAYER                                    │
│                                                                                      │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐             │
│  │  PostgreSQL  │  │    Redis     │  │ Elasticsearch│  │  Qdrant/     │             │
│  │  (Primary)   │  │   (Cache)    │  │  (Logs/ELK)  │  │  Pinecone    │             │
│  │              │  │              │  │              │  │ (Vector DB)  │             │
│  │ - 예약 데이터 │  │ - Session    │  │ - App Logs   │  │ - FAQ 임베딩  │             │
│  │ - 고객 정보   │  │ - AI Cache   │  │ - Events     │  │ - 차량 임베딩  │             │
│  │ - 차량 정보   │  │ - Rate Limit │  │ - Metrics    │  │              │             │
│  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘             │
│                                                                                      │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                               │
│  │   MLflow     │  │   MinIO/S3   │  │   Kafka      │                               │
│  │ (ML Ops)     │  │ (Model/Data) │  │ (Event Bus)  │                               │
│  │              │  │              │  │              │                               │
│  │ - 실험 추적   │  │ - 모델 저장   │  │ - 이벤트 수집 │                               │
│  │ - 모델 버전   │  │ - 피처 저장   │  │ - 실시간 처리 │                               │
│  └──────────────┘  └──────────────┘  └──────────────┘                               │
└─────────────────────────────────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════════════════════════════
                                   DATA FLOW
═══════════════════════════════════════════════════════════════════════════════════════

[추천 엔진 Flow]
User Request → Spring Boot → Redis Cache Check → (Miss) → Python Recommend API
    → Feature Store에서 사용자 피처 조회 → 모델 추론 → 결과 캐싱 → Response

[챗봇 Flow]  
User Message → Spring Boot → Python Chatbot API → 의도 분류
    → (FAQ) → Qdrant 벡터 검색 → LLM 답변 생성
    → (예약문의) → Spring Boot 예약 API 호출 → 결과 포맷팅 → Response

[가격 예측 Flow]
Admin/Batch → Spring Boot → Python Pricing API 
    → Feature Engineering (수요/공급/시즌/요일/이벤트)
    → 모델 추론 → 추천 가격 반환 → DB 저장

[행동 분석 Flow]
User Event → Spring Boot → Kafka Producer → Kafka
    → Python Consumer → Elasticsearch 저장
    → 배치 집계 → Dashboard API → Admin Panel

┌─────────────────────────────────────────────────────────────────┐
│                         CLIENT                                   │
│            (Mobile App / Web / Admin Panel)                      │
└─────────────────────────┬───────────────────────────────────────┘
                          │ HTTPS
                          ▼
┌─────────────────────────────────────────────────────────────────┐
│                 SPRING BOOT (port: 8080)                         │
│                    way-api-gateway                               │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  • 인증/인가 (JWT)                                        │    │
│  │  • 비즈니스 로직 (예약/차량/고객)                           │    │
│  │  • AI 서비스 프록시 (WebClient)                           │    │
│  │  • 이벤트 발행 (Kafka Producer)                           │    │
│  └─────────────────────────────────────────────────────────┘    │
└─────────────────────────┬───────────────────────────────────────┘
                          │ REST API (Internal)
                          ▼
┌─────────────────────────────────────────────────────────────────┐
│                  PYTHON FASTAPI (port: 8000)                     │
│                     way-ai-services                              │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐           │
│  │ 추천엔진  │ │  챗봇    │ │ 가격예측  │ │ 행동분석  │           │
│  │ /recommend│ │  /chat   │ │ /pricing │ │/analytics│           │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘           │
└─────────────────────────┬───────────────────────────────────────┘
                          │
          ┌───────────────┼───────────────┬───────────────┐
          ▼               ▼               ▼               ▼
     ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐
     │  MySQL  │    │  Redis  │    │ Qdrant  │    │  Kafka  │
     │  :3306  │    │  :6379  │    │  :6333  │    │  :9092  │
     └─────────┘    └─────────┘    └─────────┘    └─────────┘

graph LR
    A[현재: API 완성] --> B[1. 실제 로직 구현]
    B --> C[2. DB 연결]
    C --> D[3. 인증 추가]
    D --> E[4. Docker화]
    E --> F[5. 배포]

